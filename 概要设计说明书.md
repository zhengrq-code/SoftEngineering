# <center>概要设计说明书</center>

### 一、引言

#### 1.1 编写目的

在先前的需求分析阶段，已经将系统用户对本系统的需求做了详细的阐述。本阶段是在需求分析的基础上，对每日做到小程序做概要设计。主要解决了实现该系统需求的程序模块设计的问题。包括如何把系统分成若干个模块、决定各个模块之间的接口、模块之间传递的信息，以及数据结构、模块结构的设计等。在以下的概要设计中将对在本阶段所有的概要设计做详细的说明。

程序员可以以概要设计为依据，在此基础上进行详细设计。在以后的软件测试和软件维护也可以参考此说明书。

#### 1.2 背景

（1）项目名称：每日做到

（2）用户：微信用户

（3）运行环境：安卓、IOS

（4）开发工具：微信开发者平台

（5）开发者：每日做到小团队

#### 1.3 定义

查询：对数据库的一种操作，用于搜索数据信息。

更新：对数据库的一种操作，用于更改数据库中的数据信息。

前端：开发和维护与用户交互的页面

后端：协调前端与数据库之间的逻辑控制程序

软件结构图：用于反应软件系统的功能模块之间的关系的数据图。

#### 1.4 参考资料

 [1] GB/T 8567-2006 计算机软件文档编制规范

 [2] GB/T 8567-1988 计算机软件产品开发文件编制指南

### 二、总体设计

#### 2.1 需求规定

本项目主要完成一个小程序，该小程序名为”每日做到“，该小小程序的主要功能有：

+ 发布每日挑战

用户可以通过这个软件发布每日挑战，内容是自己在当天需要达到的小目标。例如早起挑战，今天要在早上6点起床；早睡挑战，今天要在晚上11点睡觉；手机挑战，今天使用手机的时间要在2小时以内；单词挑战，今天要背10个单词；跑步挑战，今天要跑步1公里；等等。

+ 完成每日挑战

对每个每日挑战，用户可以在截至时间之前进行打卡，表示该挑战已经完成。如果在截至时间之内用户没有进行打卡，则表明该挑战失败。当用户完成一个每日挑战后，就可以获取相应的挑战积分。

+ 加入每日挑战

用户可以在软件中浏览并查询其它用户发布的每日挑战，然后可以选择是否加入该挑战。

+ 每日排行榜

在每日排行榜中，会根据用户在今天内获取的挑战积分数量进行排名。

+ 挑战推荐

我们的产品能够为用户推荐一些常见的挑战，例如每天运动半小时、早睡早起等。用户可以将这些挑战加入到自己的每日挑战中。

+ 日记功能

用户除了完成各种各样的挑战之外，还能够通过日记功能来记录每一天的进步或者每一天中有意义有价值的事情。另一方面，用户能够在一段时间后通过日记来回顾自己近期的状态。

+ 打卡分享功能

用户每天在完成自己定下的任务之后，能够进行打卡分享的功能。通过打卡分享，用户能够将自己每天完成的挑战分享给自己的好友，一方面使得产品具有更强的社交性，另一方面，用户能够通过分享也有利于产品的推广。

+ 生成近期状态评估报告

用户在使用产品一段时间后，我们的产品能够记录用户在这段时间能挑战的完成情况以及挑战的数量来生成一份评估报告，并将其统计数据反馈给用户，用户能够将状态评估报告作为参考评估自身近期的状态，促进自我的进步发展。

#### 2.2 运行环境

本小程序主要运行在手机端，可以在任意能够运行微信的智能手机上运行。

#### 2.3 基本设计概念和处理流程

**基本设计概念**

设计的基本概念采用`client-server`的模式，用户手机运行客户端，通过小程序提供的接口，向后台发出请求，后台接收到请求后进行相应的处理，再将响应信息反馈给用户。

**处理流程**

本系统设计两个对象，即用户和数据库，流程可以表示为：

![处理流程](imags\处理流程.png)

#### 2.4 结构

用一览表及框图的形式说明本系统的系统元素（各层模块，子程序，公用程序等）的划分，扼要说明每个系统元素的标志符和功能，分层次地给出各元素之间的控制与被控制关系。

本系统按照不同会话来划分的话可以分为两大系统模块

**用户登录模块**

首先用户在登录页面输入密码，然后小程序接收密码并访问数据库，查询数据库，确认密码是否正确后将信息返回给小程序，小程序将登录信息反馈给用户。具体流程图可表示如下。

![用户登录模块](imags\用户登录模块.png)

**发布任务及执行任务模块**

当用户需要发布任务时，首先在小程序页面输入任务的有关信息，小程序接收到信息后，访问数据库并写入对应的信息，然后将修改成功的结果反馈给用户。用户对任务的有关操作都可以类似执行。

![发布任务](imags\发布任务.png)

#### 2.5 功能需求与程序的关系

使用下表来说明各项功能需求的实现同各模块之间的分配关系

|              | 获取并发送用户请求 | 接受并识别用户请求 | 查询数据库 | 返回信息给用户 |
| ------------ | ------------------ | ------------------ | ---------- | -------------- |
| 用户登录     | Y                  | Y                  | Y          |                |
| 发布每日任务 | Y                  | Y                  | Y          | Y              |
| 完成每日任务 |                    | Y                  | Y          |                |
| 加入每日任务 |                    | Y                  | Y          |                |
| 每日排行榜   |                    |                    | Y          | Y              |
| 挑战推荐     |                    |                    | Y          | Y              |
| 日记功能     | Y                  | Y                  |            |                |
| 打卡分享     | Y                  | Y                  |            |                |
| 生成评估报告 |                    | Y                  | Y          | Y              |

#### 2.6 人工处理过程

本系统均为线上操作，通过小程序即可与数据库进行交互。无需人工的介入，所以不需要人工处理过程。

#### 2.7 尚未解决的问题

需要处理的问题主要有：

+ 用户登录时需要获取用户的信息，需要通过加密手段来保证用户信息的安全。
+ 打卡分享时要访问微信或者其他软件，需要申请对应的接口。

### 三、接口设计

接口设计的大致框架如下：

![接口](imags\接口.png)

#### 3.1 用户接口

本产品的用户一般需要通过微信进行授权登录，进入小程序主界面后点击相关按钮，可以分别进入相对应的界面(如：用户个人信息页面、每日挑战排行榜页面)。用户接口应交由前端进行开发，根据具体不同功能设计出对应的用户接口。对于程序的维护，最好需要进行备份。

#### 3.2 外部接口

1. 与微信的登录接口：通过该API来确认用户信息，提取对应的好友信息。
2. 与微信的分享接口：通过该API，用户可以分享自己的日志或任务完成情况。
3. 与手机硬件的接口：通过该API，用户可以上传自己的照片或者系统可以获取用户的音频等。

#### 3.3 内部接口

内部接口主要为后端为前端提供的接口以及数据库系统为后端提供的接口。对于不同的功能实现，后端均需要为提供内部接口用于数据交互。根据不同的功能模块可以设计如下内部接口：

1. 数据库接口：该API主要用于后端与数据库的交互上，针对用户的不同需求，又可以将其分为下面更小的接口：
   - 每日任务查询接口：用于查询用户任务具体信息。
   - 每日任务更新接口：用于对用户任务信息进行更新。
   - 每日任务删除接口：用于删除用户任务信息中的具体任务。
   - 每日任务插入接口：用于用户增加新的任务。

2. 与前端的接口：该接口主要通过url实现，通过解析url来确认用户所需要执行的操作是什么，后端根据该接口接收到的具体信息来执行不同的程序。

3. 与分析程序的接口：分析程序主要是对不同用户的具体信息进行分析，通过该接口向分析程序传递所需要分析的用户标签，分析程序完成分析之后反馈分析报告。


### 四、 运行设计

#### 4.1 运行模块组合
说明对系统施加不同的外界运行控制时所引起的各种不同的运行模块组合，说明每种运行所历经的内部模块的支持软件。

启动：调用启动模块，包括数据接收模块、网络传输模块、数据输出模块。

登录：调用登录模块，包括数据接收模块、网络传输模块、数据查询模块、数据输出模块。

退出：调用退出模块，包括数据接收模块、网络传输模块、数据输出模块。

交互：调用对应的功能模块，包括数据接收模块、网络传输模块、数据查询模块、数据处理模块、数据修改模块、数据输出模块。

数据处理：首先调用数据接收模块，接收输入的数据。接收完毕后，调用网络传输模块,将数据通过网络送到服务器,并等待接收服务器返回的信息。服务器接收到数据后，会调用数据处理的相关模块执行相应操作，并将对应的操作结果返回。客户端接收到对应的返回信息后就会调用数据输出模块，产生对应的输出。

#### 4.2 运行控制

说明每一种外界的运行控制的方式方法和操作步骤。

启动：在微信小程序中找到该应用，单击该应用，即可完成启动操作。在启动过程中，应用会调用启动模块的相关函数，完成应用的启动工作。

登录：在登录界面中，输入用户名和密码，然后点击登录按钮，即可完成登录操作。在登录过程中，应用会调用登录模块的相关函数，并在数据库中查询用户名和其对应的密码。 如果存在该用户名且密码正确，就会从登录界面跳转到应用界面，完成登录；如果不存在该用户名或者密码错误，就显示登录失败，停留在登录界面。

退出：在登录界面或者应用界面中，单击退出按钮，并点击确定，即可完成退出操作。在退出过程中，应用会调用退出模块的相关函数，完成应用的退出操作。

交互：在应用界面中，点击对应的功能按钮，即可进行与该功能的交互操作。在交互过程中，应用会调用对应功能模块的相关函数，根据用户向服务器发送的数据执行相应的操作，例如数据查询，在数据库中查找对应数据；数据处理，调用处理模块处理相关数据，将结果返回给用户；数据添加，在数据库中加入新的数据；数据删除，将数据库中的对应数据删除；数据修改，更改数据库中的对应数据；等等。


#### 4.3 运行时间

说明每种运行模块组合将占用各种资源的时间。

启动：占用启动模块，包括数据接收模块、网络传输模块、数据输出模块。

登录：占用登录模块，包括数据接收模块、网络传输模块、数据查询模块、数据输出模块。

退出：占用退出模块，包括数据接收模块、网络传输模块、数据输出模块。

交互：占用对应功能模块，包括数据接收模块、网络传输模块、数据查询模块、数据处理模块、数据修改模块、数据输出模块。


### 五、系统数据结构设计

#### 5.1 数据结果

**用户信息表UserInfo**

| 变量名 | 类型        | 含义         | 说明                 |
| ------ | ----------- | ------------ | -------------------- |
| uid    | varchar(15) | 用户id       | 主键                 |
| uname  | varchar(15) | 用户昵称     | not null             |
| gender | bool        | 性别         | 0表示女性，1表示男性 |
| mail   | varchar(20) | 用户邮箱     |                      |
| wxid   | varchar(20) | 用户的微信号 |                      |

**任务信息表TaskInfo**

| 变量名      | 类型        | 含义         | 说明                       |
| ----------- | ----------- | ------------ | -------------------------- |
| tid         | varchar(15) | 任务编号     | 主键                       |
| tname       | varchar(15) | 任务名称     | not null                   |
| start_time  | varchar(20) | 任务发布时间 | not null                   |
| finish_time | varchar(20) | 任务完成时间 | 完成任务的最后期限         |
| finished    | bool        | 任务是否完成 | 0表示为未完成，1表示已完成 |

#### 5.2 文件和数据库结构

  ![类图.drawio](imags\类图.drawio.png)



### 六、系统出错处理设计

#### 6.1 出错信息

1、数据库错误：

连接错误：数据库本身

连接超时：数据库代码错误


2、TCP连接错误：

连接错误：连接超时.错误


3、系统部分自定义错误：

权限错误：管理员权限设置故障

输入错误：用户ID，密码错误/为空


4、链接错误：

内部连接错误：文件/图片/网页链接错误

外部连接错误：网页维护


#### 6.2 补救措施

a. 后备技术，周期性的把错误信息记录在硬盘上。

b. 降效技术，对于部分重要的数据，采用人工输入数据的方式，确保数据的正确性。

c. 对于软错误，在添加/修改操作中及时对输入数据进行验证，分析错误的类型，并且给出相应的错误提示语句，传送到客户端的浏览器上。

d．对于硬错误，因为错误类型较少而且比较明确，所以在可能出错的地方中输出相应的出错语句，并将程序重置，最后返回输入阶段；

e. 恢复及再启动技术，定期添加备份，使软件可以从故障点恢复执行或从头开始重新运行。

#### 6.3 系统维护设计

1、定期备份数据库

2、定期检测数据库的一致性

3、定期查看操作日志

4、定期删除相关文件，减少数据量

